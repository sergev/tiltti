//
// Conversions of Code Page 437 to/from Unicode.
//
#include "encoding.h"

const unsigned short cp437_to_unicode_table[256] = {
    // clang-format off
    0x00,  0x01,  0x02,  0x03,  0x04,  0x05,  0x06,  0x07,
    0x08,  0x09,  0x0a,  0x0b,  0x0c,  0x0d,  0x0e,  0x0f,
    0x10,  0x11,  0x12,  0x13,  0x14,  0x15,  0x16,  0x17,
    0x18,  0x19,  0x1a,  0x1b,  0x1c,  0x1d,  0x1e,  0x1f,
    0x20,  0x21,  0x22,  0x23,  0x24,  0x25,  0x26,  0x27,
    0x28,  0x29,  0x2a,  0x2b,  0x2c,  0x2d,  0x2e,  0x2f,
    0x30,  0x31,  0x32,  0x33,  0x34,  0x35,  0x36,  0x37,
    0x38,  0x39,  0x3a,  0x3b,  0x3c,  0x3d,  0x3e,  0x3f,
    0x40,  0x41,  0x42,  0x43,  0x44,  0x45,  0x46,  0x47,
    0x48,  0x49,  0x4a,  0x4b,  0x4c,  0x4d,  0x4e,  0x4f,
    0x50,  0x51,  0x52,  0x53,  0x54,  0x55,  0x56,  0x57,
    0x58,  0x59,  0x5a,  0x5b,  0x5c,  0x5d,  0x5e,  0x5f,
    0x60,  0x61,  0x62,  0x63,  0x64,  0x65,  0x66,  0x67,
    0x68,  0x69,  0x6a,  0x6b,  0x6c,  0x6d,  0x6e,  0x6f,
    0x70,  0x71,  0x72,  0x73,  0x74,  0x75,  0x76,  0x77,
    0x78,  0x79,  0x7a,  0x7b,  0x7c,  0x7d,  0x7e,  0x7f,
    0xc7,  0xfc,  0xe9,  0xe2,  0xe4,  0xe0,  0xe5,  0xe7,
    0xea,  0xeb,  0xe8,  0xef,  0xee,  0xec,  0xc4,  0xc5,
    0xc9,  0xe6,  0xc6,  0xf4,  0xf6,  0xf2,  0xfb,  0xf9,
    0xff,  0xd6,  0xdc,  0xa2,  0xa3,  0xa5,  0x20a7,0x0192,
    0xe1,  0xed,  0xf3,  0xfa,  0xf1,  0xd1,  0xaa,  0xba,
    0xbf,  0x2310,0xac,  0xbd,  0xbc,  0xa1,  0xab,  0xbb,
    0x2591,0x2592,0x2593,0x2502,0x2524,0x2561,0x2562,0x2556,
    0x2555,0x2563,0x2551,0x2557,0x255d,0x255c,0x255b,0x2510,
    0x2514,0x2534,0x252c,0x251c,0x2500,0x253c,0x255e,0x255f,
    0x255a,0x2554,0x2569,0x2566,0x2560,0x2550,0x256c,0x2567,
    0x2568,0x2564,0x2565,0x2559,0x2558,0x2552,0x2553,0x256b,
    0x256a,0x2518,0x250c,0x2588,0x2584,0x258c,0x2590,0x2580,
    0x03b1,0xdf,  0x0393,0x03c0,0x03a3,0x03c3,0xb5,  0x03c4,
    0x03a6,0x0398,0x03a9,0x03b4,0x221e,0x03c6,0x03b5,0x2229,
    0x2261,0xb1,  0x2265,0x2264,0x2320,0x2321,0xf7,  0x2248,
    0xb0,  0x2219,0xb7,  0x221a,0x207f,0xb2,  0x25a0,0xa0,
    // clang-format on
};

unsigned char unicode_to_cp437(unsigned short val)
{
    static unsigned char tab0[256] = {
        // clang-format off
        0,    0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
        0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e, 0x0f,
        0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17,
        0x18, 0x19, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f,
        0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27,
        0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f,
        0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37,
        0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x3e, 0x3f,
        0x40, 0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47,
        0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x4d, 0x4e, 0x4f,
        0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57,
        0x58, 0x59, 0x5a, 0x5b, 0x5c, 0x5d, 0x5e, 0x5f,
        0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67,
        0x68, 0x69, 0x6a, 0x6b, 0x6c, 0x6d, 0x6e, 0x6f,
        0x70, 0x71, 0x72, 0x73, 0x74, 0x75, 0x76, 0x77,
        0x78, 0x79, 0x7a, 0x7b, 0x7c, 0x7d, 0x7e, 0x7f,
        0,    0,    0,    0,    0,    0,    0,    0,
        0,    0,    0,    0,    0,    0,    0,    0,
        0,    0,    0,    0,    0,    0,    0,    0,
        0,    0,    0,    0,    0,    0,    0,    0,
        0xff, 0xad, 0x9b, 0x9c, 0,    0x9d, 0,    0,
        0,    0,    0xa6, 0xae, 0xaa, 0,    0,    0,
        0xf8, 0xf1, 0xfd, 0,    0,    0xe6, 0,    0xfa,
        0,    0,    0xa7, 0xaf, 0xac, 0xab, 0,    0xa8,
        0,    0,    0,    0,    0x8e, 0x8f, 0x92, 0x80,
        0,    0x90, 0,    0,    0,    0,    0,    0,
        0,    0xa5, 0,    0,    0,    0,    0x99, 0,
        0,    0,    0,    0,    0x9a, 0,    0,    0xe1,
        0x85, 0xa0, 0x83, 0,    0x84, 0x86, 0x91, 0x87,
        0x8a, 0x82, 0x88, 0x89, 0x8d, 0xa1, 0x8c, 0x8b,
        0,    0xa4, 0x95, 0xa2, 0x93, 0,    0x94, 0xf6,
        0,    0x97, 0xa3, 0x96, 0x81, 0,    0,    0x98,
        // clang-format on
    };
    switch (val >> 8) {
    case 0x00:
        return tab0[val];
    case 0x01:
        // clang-format off
        switch ((unsigned char) val) {
        case 0x92: return 0x9f;
        }
        break;
    case 0x03:
        switch ((unsigned char) val) {
        case 0x93: return 0xe2;
        case 0x98: return 0xe9;
        case 0xa3: return 0xe4;
        case 0xa6: return 0xe8;
        case 0xa9: return 0xea;
        case 0xb1: return 0xe0;
        case 0xb4: return 0xeb;
        case 0xb5: return 0xee;
        case 0xc0: return 0xe3;
        case 0xc3: return 0xe5;
        case 0xc4: return 0xe7;
        case 0xc6: return 0xed;
        }
        break;
    case 0x20:
        switch ((unsigned char) val) {
        case 0x28: return 0x0a;
        case 0x7f: return 0xfc;
        case 0xa7: return 0x9e;
        }
        break;
    case 0x22:
        switch ((unsigned char) val) {
        case 0x19: return 0xf9;
        case 0x1a: return 0xfb;
        case 0x1e: return 0xec;
        case 0x29: return 0xef;
        case 0x48: return 0xf7;
        case 0x61: return 0xf0;
        case 0x64: return 0xf3;
        case 0x65: return 0xf2;
        }
        break;
    case 0x23:
        switch ((unsigned char) val) {
        case 0x10: return 0xa9;
        case 0x20: return 0xf4;
        case 0x21: return 0xf5;
        }
        break;
    case 0x25:
        switch ((unsigned char) val) {
        case 0x00: return 0xc4;
        case 0x02: return 0xb3;
        case 0x0c: return 0xda;
        case 0x10: return 0xbf;
        case 0x14: return 0xc0;
        case 0x18: return 0xd9;
        case 0x1c: return 0xc3;
        case 0x24: return 0xb4;
        case 0x2c: return 0xc2;
        case 0x34: return 0xc1;
        case 0x3c: return 0xc5;
        case 0x50: return 0xcd;
        case 0x51: return 0xba;
        case 0x52: return 0xd5;
        case 0x53: return 0xd6;
        case 0x54: return 0xc9;
        case 0x55: return 0xb8;
        case 0x56: return 0xb7;
        case 0x57: return 0xbb;
        case 0x58: return 0xd4;
        case 0x59: return 0xd3;
        case 0x5a: return 0xc8;
        case 0x5b: return 0xbe;
        case 0x5c: return 0xbd;
        case 0x5d: return 0xbc;
        case 0x5e: return 0xc6;
        case 0x5f: return 0xc7;
        case 0x60: return 0xcc;
        case 0x61: return 0xb5;
        case 0x62: return 0xb6;
        case 0x63: return 0xb9;
        case 0x64: return 0xd1;
        case 0x65: return 0xd2;
        case 0x66: return 0xcb;
        case 0x67: return 0xcf;
        case 0x68: return 0xd0;
        case 0x69: return 0xca;
        case 0x6a: return 0xd8;
        case 0x6b: return 0xd7;
        case 0x6c: return 0xce;
        case 0x80: return 0xdf;
        case 0x84: return 0xdc;
        case 0x88: return 0xdb;
        case 0x8c: return 0xdd;
        case 0x90: return 0xde;
        case 0x91: return 0xb0;
        case 0x92: return 0xb1;
        case 0x93: return 0xb2;
        case 0xa0: return 0xfe;
        }
        // clang-format on
        break;
    }
    return 0;
}
